<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>QLink Bridge UI</title>
    <style>
        body {
            font-family: system-ui, Arial;
            max-width: 800px;
            margin: 2rem;
        }

        label {
            display: block;
            margin-top: 1rem
        }

        input,
        select {
            font-size: 1rem;
            padding: .3rem
        }

        button {
            margin-top: 1rem;
            padding: .5rem 1rem
        }

        pre {
            background: #f5f5f5;
            padding: 1rem
        }
    </style>
</head>

<body>
    <h1>QLink Bridge â€” Local UI</h1>
    <p>Use this page on the Pi (http://&lt;pi-host&gt;:8000/ui/) to send VLO/VGL commands and test devices locally.</p>

    <label>Device ID
        <input id="device" type="number" value="251">
    </label>

    <label>Level (0-100)
        <input id="level" type="number" value="100" min="0" max="100">
    </label>

    <label>Fade
        <input id="fade" type="text" value="2.3">
    </label>

    <div>
        <button id="setBtn">Set Level (VLO)</button>
        <button id="onBtn">On (VLO 100)</button>
        <button id="offBtn">Off (VLO 0)</button>
        <button id="readBtn">Read Level (VGL)</button>
    </div>

    <h3>Raw send</h3>
    <label>Command (no CR)</label>
    <input id="rawcmd" type="text" style="width:100%" placeholder="VLO 251 100 2.3">
    <button id="rawSend">Send Raw</button>

    <h3>Response</h3>
    <pre id="resp">(no response yet)</pre>

    <script>
        async function postJson(path, body) {
            const res = await fetch(path, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body) });
            return res.json();
        }

        async function getJson(path) {
            const res = await fetch(path);
            return res.json();
        }

        const respEl = document.getElementById('resp');
        const deviceEl = document.getElementById('device');
        const levelEl = document.getElementById('level');
        const fadeEl = document.getElementById('fade');

        document.getElementById('setBtn').addEventListener('click', async () => {
            const id = deviceEl.value; const lvl = levelEl.value; const fade = fadeEl.value;
            respEl.textContent = 'sending...';
            try {
                const r = await postJson(`/device/${id}/set`, { level: parseInt(lvl, 10) });
                respEl.textContent = JSON.stringify(r, null, 2);
            } catch (e) { respEl.textContent = String(e); }
        });

        document.getElementById('onBtn').addEventListener('click', async () => {
            const id = deviceEl.value; const fade = fadeEl.value;
            respEl.textContent = 'sending...';
            try {
                const r = await postJson(`/device/${id}/set`, { switch: 'on' });
                respEl.textContent = JSON.stringify(r, null, 2);
            } catch (e) { respEl.textContent = String(e); }
        });

        document.getElementById('offBtn').addEventListener('click', async () => {
            const id = deviceEl.value; const fade = fadeEl.value;
            respEl.textContent = 'sending...';
            try {
                const r = await postJson(`/device/${id}/set`, { switch: 'off' });
                respEl.textContent = JSON.stringify(r, null, 2);
            } catch (e) { respEl.textContent = String(e); }
        });

        document.getElementById('readBtn').addEventListener('click', async () => {
            const id = deviceEl.value;
            respEl.textContent = 'sending...';
            try {
                const r = await getJson(`/send/VGL%20${encodeURIComponent(id)}`);
                respEl.textContent = JSON.stringify(r, null, 2);
            } catch (e) { respEl.textContent = String(e); }
        });

        document.getElementById('rawSend').addEventListener('click', async () => {
            const cmd = document.getElementById('rawcmd').value;
            respEl.textContent = 'sending...';
            try {
                const r = await getJson('/send/' + encodeURIComponent(cmd));
                respEl.textContent = JSON.stringify(r, null, 2);
            } catch (e) { respEl.textContent = String(e); }
        });
    </script>
</body>

</html>